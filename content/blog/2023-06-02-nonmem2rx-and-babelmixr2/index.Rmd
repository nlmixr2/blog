---
title: nonmem2rx and babelmixr2
author: 'Matt Fidler and the nlmixr2 Development Team'
date: '2023-06-02'
slug: []
categories: [nlmixr2, babelmixr2, nonmem2rx, nonmem]
tags: [new-version]
---

![nonmem2rx/babelmixr2](featured.png)

I am really excited to announce that the `nlmixr2` team has released a
new version of `babelmixr2` and a new package `nonmem2rx` that allows
you to convert `NONMEM` to `rxode2` or even a `nlmixr2` object.  To
install, simply upgrade `babelmixr2` with:

``` r
install.packages(c("nonmem2rx", "babelmixr2"))
```

## What you can do with `nonmem2rx`

Here is a list of things that you can do with
`nonmem2rx`/`babelmixr2`: 

- [Convert a `NONMEM` model to a `rxode2`
  model](https://nlmixr2.github.io/nonmem2rx/articles/import-nonmem.html)
  
- [Make sure the model is translated correctly](https://nlmixr2.github.io/nonmem2rx/articles/rxode2-validate.html)

- Then with this model, you can:

  - Perform [simulations of new
    dosing](https://nlmixr2.github.io/nonmem2rx/articles/simulate-new-dosing.html)
    from the NONMEM model or even [simulate using the uncertainty in your model](https://nlmixr2.github.io/nonmem2rx/articles/simulate-uncertainty.html)
    to simulate new scenarios
  
  - [Modify the model to calculate derived
    parameters](https://nlmixr2.github.io/nonmem2rx/articles/simulate-extra-items.html)
    (like AUC). These parameters slow down NONMEM's optimization, but
    can help in your simulation scenario.

- With `nonmem2rx` and `babelmixr2`, [convert the imported `rxode2`
  model to a `nlmixr2` object](https://nlmixr2.github.io/nonmem2rx/articles/convert-nlmixr2.html), allowing:
  
  - [Generation of Word and PowerPoint plots with `nlmixr2rpt`](https://nlmixr2.github.io/nonmem2rx/articles/create-office.html)
  
  - [Easy VPC creation (with `vpcPlot()`)](https://nlmixr2.github.io/nonmem2rx/articles/create-vpc.html)
  
  - [Easy Individual plots with extra solved
    points](https://nlmixr2.github.io/nonmem2rx/articles/create-augPred.html).
    This will show the curvature of individual and population fits for sparse
    data-sets (with `augPred()`)
    
- You can even use this conversion to help debug your NONMEM model (or
  even try it in `nlmixr2` instead)
  
  - Understand [how to simplify the NONMEM model to avoid rounding errors](https://nlmixr2.github.io/nonmem2rx/articles/read-rounding.html)
  
  - [Run `nlmixr2`'s covariance step when `NONMEM`s covariance step
    has
    failed](https://nlmixr2.github.io/nonmem2rx/articles/read-rounding.html#step-5-get-the-covariance-of-the-model)
    (in the linked example, there was no covariance step because
    rounding errors)

I am most excited about the ability to help debug `NONMEM` models
since I spent so much time of my life trying to figure out rounding
errors and covariance steps.

## Another validation metric -- why?

With `nonmem2rx` we introduce a new validation metric: `IWRES`.

Both `babelmixr2` and `mrgsolve` have used `IPRED` and `PRED` (see
[nlmixr2
blog](https://blog.nlmixr2.org/blog/2022-11-11-babelmixr2-nonmem/) and
[mrgsolve blog
#1](https://mrgsolve.org/blog/posts/2022-05-validate-translation/),
[mrgsolve blog
#2](https://mrgsolve.org/blog/posts/2023-update-validation.html)). They
validate the model for each eta and the population. 

What the previous approaches miss is the way the unexplained
variability is coded.  In general, `nlmixr2` estimates residual
standard deviation instead of variability.  The `IWRES` allows the
model translations to be back-checked to make sure that the residual
variability is coded correctly.

It is quite handy to finish the `rxode2` conversion from `NONMEM` and
make sure it matches `nlmixr2`-type model.

With this extra check, you may wonder will there be any other checks
of model coding or translation?  The current checks check the overall
model, the individual model, and the residual model.

The only other item that isn't validated by the checks is the between
subject variability covariance matrix.  Note that the structure of the
between subject variability etas is tested with the `IPRED`s. This
means as long as the covariance matrix is imported correctly, all
simulations should be reasonable.

One way to validate a reasonable between subject variability
covariance matrix is simply to perform a `VPC`. If the `PRED`, `IPRED`
and `IWRES` all validate, a good `VPC` will also show that the
imported between subject variability matrix is correct (otherwise the
simulated values would not match).

The other way is to do a manual check of the covariance matrix import.
With simple covariance matrices this shouldn't take too much time.

## Visit our poster at PAGE

We will have a poster about this at PAGE.  Stop by and say hi and get
some hex stickers for these new projects.  Also let us know what you
think about `nlmixr2` right now.

We are grateful for all the community support and hope this is useful
for your analysis as well.

## Next steps

For `babelmixr2` the next steps include creating other estimation
methods (like `nlmer` from `lme4` and `saemmix`) and importing models
from other tools (like Monolix)

I think this would be useful for many people; Let us know what you
think!  If there is something missing or something doesn't work quite
right, let us know with a github issue or discussion!
